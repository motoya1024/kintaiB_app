<%= fields_for "timecards[]", timecard do |fi| %>    
                     <td><% if !timecard.arrival_time.nil? %>
                             <%= fi.time_field :arrival_time ,value: timecard.arrival_time.strftime("%H:%M") %>
                         <% else %>
                             <%= fi.time_field :arrival_time %>
                         <% end %>
                     </td>
                     <td><% if !timecard.leaving_time.nil? %>
                             <%= fi.time_field :leaving_time ,value: timecard.leaving_time.strftime("%H:%M") %>
                         <% else %>
                             <%= fi.time_field :leaving_time %>
                         <% end %>
                     </td>
                     <td><% if !timecard.leaving_time.nil?&&!timecard.arrival_time.nil? %>
                             <%= time_diff_str(timecard.leaving_time, timecard.arrival_time)%>
                         <% end %>
                     </td>
                     <td><%= fi.text_field :remark %></td>
                  <% end %>
                  
                  
                  
                  
                  
                  # 既存データを編集する場合　!-->
        if !id.include?("x")
             # id値からtimecardデータを取得する　!-->
             timecard= Timecard.find(id)
             if !params[:timecards][id]["arrival_time"].empty?
                 timecard.arrival_time = Time.zone.local(@this_month.to_date.year,@this_month.to_date.month,day,@timecard[id]["arrival_time"].to_time.hour,@timecard[id]["arrival_time"].to_time.min)
             end
             if !params[:timecards][id]["leaving_time"].empty?
                 timecard.leaving_time = Time.zone.local(@this_month.to_date.year,@this_month.to_date.month,day,@timecard[id]["leaving_time"].to_time.hour,@timecard[id]["leaving_time"].to_time.min)
             end
             timecard.remark = @timecard[id]["remark"]
             
             timecard.save
  
         else
             #出社時間・退社時間・備考のどれかが入力された場合のみ新規登録する。
             if !params[:timecards][id]["arrival_time"].empty?||!params[:timecards][id]["leaving_time"].empty?||!params[:timecards][id]["remark"].empty?
                 timecard = @user.timecards.build
                 
                 # 出社時間が空でなかったら 
                 if !params[:timecards][id]["arrival_time"].empty?
                     timecard.arrival_time = Time.zone.local(@this_month.to_date.year,@this_month.to_date.month,day,@timecard[id]["arrival_time"].to_time.hour,@timecard[id]["arrival_time"].to_time.min)
                 end
                 #　退社時間が空でなかったら
                 if !params[:timecards][id]["leaving_time"].empty?
                     timecard.leaving_time = Time.zone.local(@this_month.to_date.year,@this_month.to_date.month,day,@timecard[id]["leaving_time"].to_time.hour,@timecard[id]["leaving_time"].to_time.min)
                 end
                 
                 timecard.year = @this_month.to_date.year
                 timecard.month = @this_month.to_date.month
                 timecard.day = day
                 timecard.remark = params[:timecards][id]["remark"]
                 
                 timecard.save
             end
         end    