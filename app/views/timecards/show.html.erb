<% provide(:title, '勤怠情報')%>
<% provide(:arrival_time, '出社') %>
<% provide(:leaving_time, '退社') %>

<div class="work">
    
    <table id="work1" class="table-bordered table-striped">
        <tr>
            <td><span id="prev_month"><%= link_to '←', timecard_path(month: @this_month<<1) %></span><%= @this_month.strftime("%Y年%m月") %> 時間管理表<span id="next_month"><%= link_to '→', timecard_path(month: @this_month>>1) %></span></td>
            <td>所定勤務時間 <%= @admin_user.specifed_time.strftime("%H:%M") %></td>
            <td colspan="2">基本時間 <%= @admin_user.basic_time.strftime("%H:%M") %></td>
            <td>初日 <%=@this_month.beginning_of_month.strftime("%m/%d") %></td>
        </tr>
         <tr>
            <td>所属 <%= @current_user.department %></td>
            <td>名前 <%= @current_user.name %></td>
            <td>コード </td>
            <td>出勤日数 <%= @arrival_count %></td>
            <td>締め <%=@this_month.end_of_month.strftime("%m/%d") %></td>
        </tr>

    </table>    
    
    <%= link_to "勤怠編集", edit_work_path, class: 'btn btn-success'%>
        
     <table id="work2" class="table-bordered table-striped">
        <tr>
            <th rowspan="2">日付</th>
            <th rowspan="2">曜日</th>
            <th colspan="3">出社 </th>
            <th colspan="3">退社 </th>
            <th rowspan="2">在社時間 </th>
            <th rowspan="2">備考 </th>
        </tr>
        <tr>
            <th>時</th>
            <th>分</th>
            <th>aaaa　</th>
            <th>時</th>
            <th>分</th>
            <th>aaaa  </th>
        </tr>
        <% (@this_month.beginning_of_month..@this_month.end_of_month).each_with_index do |date,index| %>
            <tr>
            　　<td><%= date.strftime("%m/%d")%> </td>
                <td><%= %w(日 月 火 水 木 金 土)[date.wday]%></td>
                <% if(@time_cards[index]) %>
                    <td><%= @time_cards[index].arrival_time.strftime("%H") %></td>
                    <td><%= @time_cards[index].arrival_time.strftime("%M") %></td>
                    <td></td>
                    <% if(@time_cards[index]).leaving_time %>
                        <td><%= @time_cards[index].leaving_time.strftime("%H") %></td>
                        <td><%= @time_cards[index].leaving_time.strftime("%M") %></td>
                        <td></td>
                        <td><%= time_diff_str(@time_cards[index].leaving_time - @time_cards[index].arrival_time)%></td>
                    <% else %> 
                        <td></td>
                        <td></td>
                        <% if(date == Date.today) %>
                        <td>
                            <%= form_for(@timecard ,url:leavingupdate_path) do |f| %>
                                <%= f.submit yield(:leaving_time), name:"leaving_time", class: "btn btn-primary" %>
                            <% end %>
                        </td>
                        <% end %>  
                        <td></td>
                    <% end %>    
                    <td></td>
                <% else %>
                    <td></td>
                    <td></td>
                    <% if(date == Date.today) %>
                    <td>
                        <%= form_for(@timecard) do |f| %>
                            <%= f.submit yield(:arrival_time), name:"arrival_time", class: "btn btn-primary" %>
                        <% end %>
                    </td>
                    <% end %>
                    <td></td>
                    <td></td>
                    <td></td> 
                    <td></td>
                    <td></td>
                    <td></td>
                <% end %>
             </tr>  
        <% end %>
      </table>

</div>